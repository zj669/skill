# Phase X: é€»è¾‘ä¿®å¤åè®® (Logic Repair Protocol)

## ğŸ“Œ ç›®æ ‡
å¤„ç†"Red Light"ä¸­æ–­æƒ…å†µï¼Œä¿®å¤æ•°æ®å†²çªæˆ–å‰§æƒ…çŸ›ç›¾ã€‚

---

## ğŸš¨ è§¦å‘æ¡ä»¶

å½“ä»¥ä¸‹ä»»ä¸€æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒMaster Router å¼ºåˆ¶è·³è½¬åˆ°æ­¤ Phaseï¼š

| é”™è¯¯ç±»å‹ | é”™è¯¯ç  | ç¤ºä¾‹ |
|---------|--------|------|
| ç‰©å“ä¸å­˜åœ¨ | `E001` | ä¸»è§’ä½¿ç”¨äº†èƒŒåŒ…é‡Œæ²¡æœ‰çš„"ä¹è½¬é‡‘ä¸¹" |
| è§’è‰²å·²æ­»äº¡ | `E002` | å‰§æƒ…ä¸­å‡ºç°äº†å·²è¢«å‡»æ€çš„"ç‹è™" |
| æˆ˜åŠ›è¶Šç•Œ | `E003` | ç»ƒæ°”æœŸä¸»è§’ç§’æ€äº†å…ƒå©´æœŸæ•Œäºº |
| æŠ€èƒ½æœªå­¦ | `E004` | ä½¿ç”¨äº†æŠ€èƒ½æ ‘ä¸­æ²¡æœ‰çš„"çƒˆé˜³æŒ" |
| å…³ç³»çŸ›ç›¾ | `E005` | å¯¹ä»‡äººè¡¨ç°å‡ºå‹å¥½æ€åº¦ |

---

## ğŸ›  ä¿®å¤ç­–ç•¥

### Option 1: Retcon (ä¿®æ”¹æ•°æ®)

**é€‚ç”¨åœºæ™¯**: è½»å¾®ç–æ¼ï¼Œå¯ä»¥é€šè¿‡è¡¥å……è®¾å®šåˆç†åŒ–ã€‚

**æ“ä½œæµç¨‹**:
1. ç¡®è®¤ä¿®æ”¹å†…å®¹
2. è°ƒç”¨ç®¡ç†å‘˜è„šæœ¬
3. é‡æ–°è¿è¡Œ Pre-Flight Check

**ç¤ºä¾‹**:
```bash
# é—®é¢˜ï¼šä¸»è§’æ²¡æœ‰ç­‘åŸºä¸¹
# æ–¹æ¡ˆï¼šå›æº¯åˆ°ä¸Šä¸€ç« ï¼Œè®¾å®šä»–åœ¨æˆ˜æ–—åä»æ•Œäººèº«ä¸Šæœåˆ°äº†

python scripts/state_manager.py --action admin_add \
  --target "protagonist" \
  --item "ç­‘åŸºä¸¹" \
  --note "ç¬¬15ç« å‡»æ€ç‹è™åè·å¾—"
```

**æ—¥å¿—è®°å½•**:
```
[RETCON] Chapter 16: Added "ç­‘åŸºä¸¹" to inventory (retroactive loot from Chapter 15)
```

---

### Option 2: Rewrite (ä¿®æ”¹å‰§æƒ…)

**é€‚ç”¨åœºæ™¯**: é€»è¾‘ç¡¬ä¼¤ï¼Œæ— æ³•é€šè¿‡è¡¥å……è®¾å®šè§£å†³ã€‚

**æ“ä½œæµç¨‹**:
1. å®šä½å†²çªæ®µè½
2. ç”Ÿæˆæ›¿ä»£å‰§æƒ…æ–¹æ¡ˆ
3. è¿”å› Scene_Writer é‡å†™

**ç¤ºä¾‹**:
```
åŸå‰§æƒ…ï¼šä¸»è§’ä½¿ç”¨ç­‘åŸºä¸¹çªç ´ã€‚
é—®é¢˜ï¼šèƒŒåŒ…æ²¡æœ‰ç­‘åŸºä¸¹ã€‚
ä¿®æ”¹æ–¹æ¡ˆï¼šå°†çªç ´æ”¹ä¸º"ä¸»è§’èµ¶å¾€æ‹å–è¡Œå¯»æ‰¾ç­‘åŸºä¸¹"ï¼Œæœ¬ç« ç»“å°¾è®¾ç½®æ‚¬å¿µã€‚
```

**æŒ‡ä»¤**:
```
è¯·é‡å†™ç¬¬ 16 ç« çš„ç¬¬ 3 åœºæ™¯ã€‚
çº¦æŸï¼šä¸»è§’ç›®å‰æ²¡æœ‰ç­‘åŸºä¸¹ï¼Œéœ€è¦æ”¹ä¸ºå¯»æ‰¾ä¸¹è¯çš„å‰§æƒ…ã€‚
ä¿ç•™ï¼šåœºæ™¯ä¸­çš„å…¶ä»–å¯¹è¯å’Œæå†™ã€‚
```

---

### Option 3: Escalate (è¯·æ±‚äººå·¥ä»‹å…¥)

**é€‚ç”¨åœºæ™¯**: å¤æ‚çš„å‰§æƒ…æ­»ç»“ï¼ŒAI æ— æ³•è‡ªè¡Œè§£å†³ã€‚

**è¾“å‡º**:
```
âš ï¸ æ£€æµ‹åˆ°ä¸¥é‡é€»è¾‘å†²çªï¼Œéœ€è¦äººå·¥ä»‹å…¥ï¼š

**å†²çªæè¿°**: ä¸»è§’çˆ¶äº²åœ¨ç¬¬ 5 ç« å·²æ­»äº¡ï¼Œä½†ç¬¬ 16 ç« å‰§æƒ…éœ€è¦ä»–å‡ºåœºã€‚

**å¯èƒ½æ–¹æ¡ˆ**:
1. ç¬¬ 5 ç« çš„æ­»äº¡æ˜¯å‡æ­»ï¼ˆéœ€å›æº¯ä¿®æ”¹ï¼‰
2. ç¬¬ 16 ç« å‡ºåœºçš„æ˜¯æ›¿èº«/å¹»è±¡
3. å¼•å…¥å¤æ´»æœºåˆ¶ï¼ˆéœ€ä¿®æ”¹ä¸–ç•Œè§‚è®¾å®šï¼‰

è¯·é€‰æ‹©æ–¹æ¡ˆï¼Œæˆ–æä¾›è‡ªå®šä¹‰è§£å†³æ€è·¯ã€‚
```

---

## ğŸ“‹ ä¿®å¤éªŒè¯

æ— è®ºé‡‡ç”¨å“ªç§æ–¹æ¡ˆï¼Œä¿®å¤åå¿…é¡»é‡æ–°éªŒè¯ï¼š

```bash
python scripts/state_manager.py --action preflight --scene_plan "{scene_json}"
```

**éªŒè¯é€šè¿‡**: è¿”å›åŸ Phase ç»§ç»­æ‰§è¡Œã€‚
**éªŒè¯å¤±è´¥**: å¾ªç¯æ‰§è¡Œä¿®å¤ï¼Œç›´åˆ°é€šè¿‡æˆ– Escalateã€‚

---

## ğŸ“„ äº¤ä»˜ç‰©

| è¾“å‡º | ç±»å‹ | ç”¨é€” |
|------|------|------|
| `repair_log.md` | Markdown | è®°å½•æ‰€æœ‰ Retcon æ“ä½œ |
| ä¿®å¤åçš„åœºæ™¯è®¡åˆ’ | JSON | è¿”å›ç»™ Scene_Writer |

## ğŸ›‘ Stop Point
> "é€»è¾‘å†²çªå·²ä¿®å¤ã€‚
> ä¿®å¤æ–¹å¼ï¼š{retcon/rewrite}
> ä¿®å¤å†…å®¹ï¼š{description}
> 
> å³å°†è¿”å› Phase {origin_phase}ã€‚è¾“å…¥ 'Continue' ç»§ç»­ã€‚"
